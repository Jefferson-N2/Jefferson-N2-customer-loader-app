<div class="health-container" role="main">
  <!-- Encabezado -->
  <div class="health-header">
    <h1 id="health-title">Estado de Salud del Sistema</h1>
    <button
      mat-raised-button
      color="primary"
      (click)="refreshHealth()"
      aria-label="Actualizar estado de salud del sistema"
    >
      <mat-icon aria-hidden="true">refresh</mat-icon>
      Actualizar
    </button>
  </div>

  <!-- Contenido de Salud -->
  <div class="health-content" *ngIf="(health$ | async) as health" role="region" aria-labelledby="health-title">
    <!-- Card Principal de Estado -->
    <mat-card
      class="health-card main-status"
      [ngClass]="getStatusClass(health.status)"
      role="status"
      [attr.aria-label]="health.status === HealthStatus.UP ? 'Sistema operativo' : 'Sistema no disponible'"
    >
      <mat-card-header>
        <mat-card-title>Estado General</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-display">
          <mat-icon
            class="status-icon"
            [ngClass]="health.status === HealthStatus.UP ? 'icon-up' : 'icon-down'"
            aria-hidden="true"
          >
            {{ getStatusIcon(health.status) }}
          </mat-icon>
          <div class="status-info">
            <span class="status-text" role="status">{{ health.status }}</span>
            <span class="status-label">
              {{
                health.status === HealthStatus.UP
                  ? 'Sistema Operativo'
                  : 'Sistema No Disponible'
              }}
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card Servicio -->
    <mat-card class="health-card" role="region" aria-label="Información del servicio backend">
      <mat-card-header>
        <mat-card-title>Servicio Backend</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="label">Nombre:</span>
          <span class="value">{{ health.service }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Versión:</span>
          <span class="value">{{ health.version }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card Base de Datos -->
    <mat-card
      class="health-card"
      [ngClass]="getStatusClass(health.checks?.database)"
      role="status"
      [attr.aria-label]="
        'Base de datos: ' + (health.checks?.database || 'Desconocido')
      "
    >
      <mat-card-header>
        <mat-card-title>Base de Datos</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="status-display compact">
          <mat-icon
            class="status-icon"
            [ngClass]="
              health.checks?.database === HealthStatus.UP
                ? 'icon-up'
                : 'icon-down'
            "
            aria-hidden="true"
          >
            {{ getStatusIcon(health.checks?.database) }}
          </mat-icon>
          <div class="status-info">
            <span class="status-text">{{ health.checks?.database }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Card Timestamp -->
    <mat-card class="health-card" role="region" aria-label="Información de consulta">
      <mat-card-header>
        <mat-card-title>Información de Consulta</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="detail-row">
          <span class="label">Última consulta:</span>
          <span class="value" role="status">
            {{ lastRefresh$ | async | date: 'short' }}
          </span>
        </div>
        <div class="detail-row">
          <span class="label">Timestamp del servidor:</span>
          <span class="value">{{ formatTimestamp(health.timestamp) }}</span>
        </div>
        <div class="detail-row auto-refresh" role="status">
          <mat-icon
            *ngIf="isLoading$ | async"
            aria-hidden="true"
            class="refresh-icon"
          >
            sync
          </mat-icon>
          <span *ngIf="isLoading$ | async" aria-label="Actualizando estado">
            Actualizando...
          </span>
          <span *ngIf="!(isLoading$ | async)">
            Auto-refresh: cada 10 segundos
          </span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
