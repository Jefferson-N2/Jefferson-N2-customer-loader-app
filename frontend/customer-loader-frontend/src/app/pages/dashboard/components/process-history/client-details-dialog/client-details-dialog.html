<div class="dialog-header">
  <h2>Detalles del Cliente</h2>
</div>

<div class="dialog-content">
  <!-- Contenido -->
  <ng-container *ngIf="clientDetails$ | async as client">
    <!-- Información Personal -->
    <mat-card class="info-card">
      <mat-card-header>
        <mat-card-title>Información Personal</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="info-grid">
          <div class="info-item">
            <span class="label">Código Cliente</span>
            <span class="value">{{ client.clientCode }}</span>
          </div>
          <div class="info-item">
            <span class="label">Identificación</span>
            <span class="value">{{ client.idType }} - {{ client.idNumber }}</span>
          </div>
          <div class="info-item">
            <span class="label">Nombres</span>
            <span class="value">{{ client.firstNames }}</span>
          </div>
          <div class="info-item">
            <span class="label">Apellidos</span>
            <span class="value">{{ client.lastNames }}</span>
          </div>
          <div class="info-item">
            <span class="label">Fecha Nacimiento</span>
            <span class="value">{{ formatDate(client.birthDate) }}</span>
          </div>
          <div class="info-item">
            <span class="label">Fecha de Vinculación</span>
            <span class="value">{{ formatDate(client.joinDate) }}</span>
          </div>
          <div class="info-item">
            <span class="label">Email</span>
            <span class="value">
              <a [href]="'mailto:' + client.email">{{ client.email }}</a>
            </span>
          </div>
          <div class="info-item">
            <span class="label">Teléfono</span>
            <span class="value">{{ client.phoneNumber }}</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Información de Cuenta -->
    <mat-card class="account-card" *ngIf="client.account">
      <mat-card-header>
        <mat-card-title>Información de Cuenta</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="account-grid">
          <div class="account-item">
            <span class="label">Número de Cuenta</span>
            <span class="value account-number">{{ client.account.accountNumber }}</span>
          </div>
          <div class="account-item">
            <span class="label">Estado Cuenta</span>
            <span
              class="status-badge"
              [ngClass]="'status-' + (client.account!.status.toLowerCase() || 'unknown')"
            >
              {{ client.account!.status }}
            </span>
          </div>
          <div class="account-item full-width">
            <span class="label">Valor de Nómina</span>
            <span class="value payroll-value">
              {{ formatCurrency(client.account.payrollValue) }}
            </span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Historial de Pagos -->
    <mat-card class="payments-card">
      <mat-card-header>
        <mat-card-title>Historial de Pagos</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="payments-table-wrapper">
          <table mat-table [dataSource]="getPaymentHistory()" class="payments-table">
            <!-- Columna: Fecha -->
            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Fecha</th>
              <td mat-cell *matCellDef="let element">{{ formatDate(element.date) }}</td>
            </ng-container>

            <!-- Columna: Monto -->
            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Monto</th>
              <td mat-cell *matCellDef="let element">
                <span class="payment-amount">{{ formatCurrency(element.amount) }}</span>
              </td>
            </ng-container>

            <!-- Columna: Estado -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let element">
                <span
                  class="payment-status"
                  [ngClass]="'status-' + element.status?.toLowerCase()"
                >
                  {{ element.status }}
                </span>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="paymentColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: paymentColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </ng-container>

  <!-- Error -->
  <div class="error" *ngIf="error$ | async as error" role="alert">
    <mat-icon>error</mat-icon>
    <p>{{ error }}</p>
  </div>
</div>

<div class="dialog-actions">
  <button mat-button mat-dialog-close aria-label="Cerrar diálogo">
    Cerrar
  </button>
</div>
